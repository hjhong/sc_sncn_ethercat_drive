APPVERSION = $(shell git describe)
APPNAME = $(shell basename $(PWD))
VERSION_FILE = src/version.h

all: version
	xmake -f Makefile.xmos 

.PHONY: version clean

version:
	@echo "/* Autogenerated file DO NOT EDIT! */" >  $(VERSION_FILE)
	@echo ""  >>  $(VERSION_FILE)
	@echo "#pragma once" >>  $(VERSION_FILE)
	@echo ""  >>  $(VERSION_FILE)
	@echo "#define APP_VERSION    \"$(APPVERSION)\"" >>  $(VERSION_FILE)
	@echo "#define APP_DEVICENAME    \"$(APPNAME)\"" >> $(VERSION_FILE)

clean:
	@rm -f $(VERSION_FILE)
	xmake -f Makefile.xmos clean
